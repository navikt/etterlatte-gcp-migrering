#Requires functioning kubectl,kubectx, kubens and vault cli
#Usage  ./service-user-secrets $ENV $SRV_USERNAME(in vault) $SECRET_NAME
#Example ./service-user-secrets prod srvdp-speider serviceuser-srvdp-speider 


#!/bin/bash

vault login -method oidc -no-print 
username="$(vault kv get -field=username  serviceuser/$1/$2)"
password="$(vault kv get -field=password  serviceuser/$1/$2)"

kubectx "$1-gcp"
kubens teamdagpenger

kubectl create secret generic $3  --from-literal=username=$username --from-literal=password=$password

